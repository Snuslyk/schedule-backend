model Organization {
  id        Int    @id @default(autoincrement())
  name      String
  shortName String @map("short_name")

  @@map("organizations")
}

model User {
  id String @id @default(uuid())

  name     String
  email    String @unique
  password String

  roles Role[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("user")
}

enum Role {
  ADMIN
  TEACHER
  STUDENT
}

model Student {
  id   Int    @id @default(autoincrement())
  name String

  @@map("student")
}

model Group {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  schedule Schedule? @relation

  @@index([name])
  @@map("group")
}

model Schedule {
  id    Int      @id @default(autoincrement())
  start DateTime
  end   DateTime

  mode Mode @default(OTHER)

  groupId Int   @unique @map("group_id")
  group   Group @relation(fields: [groupId], references: [id], onDelete: Cascade)

  replaces Replace[]

  weekTemplate WeekTemplate[]

  @@index([groupId])
  @@map("schedule")
}

enum Mode {
  PARITY
  OTHER
}

model WeekTemplate {
  id   Int      @id @default(autoincrement())
  type WeekType @default(EVEN)
  days Day[]

  scheduleId Int      @map("schedule_id")
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@map("week_template")
}

enum WeekType {
  EVEN
  ODD
  OTHER
}

model Day {
  id      Int      @id @default(autoincrement())
  slots   Slot[]
  lessons Lesson[]

  weekTemplateId Int          @map("week_template_id")
  weekTemplate   WeekTemplate @relation(fields: [weekTemplateId], references: [id], onDelete: Cascade)

  @@map("day")
}

model Slot {
  id    Int @id @default(autoincrement())
  start Int
  end   Int

  dayId Int @map("day_id")
  day   Day @relation(fields: [dayId], references: [id], onDelete: Cascade)

  @@map("slot")
}

model Replace {
  id          Int      @id @default(autoincrement())
  date        DateTime
  slotNumber  Int      @map("order_number")
  classroom   String
  isAvailable Boolean  @default(false) @map("is_available")

  teacherId Int     @map("teacher_id")
  teacher   Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  subjectId Int     @map("subject_id")
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  scheduleId Int      @map("schedule_id")
  schedule   Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@map("replace")
}

model Lesson {
  id          Int     @id @default(autoincrement())
  classroom   String
  slotNumber  Int     @map("order_number")
  slotLength  Int     @map("order_length")
  isAvailable Boolean @default(false) @map("is_available")

  teacherId Int     @map("teacher_id")
  teacher   Teacher @relation(fields: [teacherId], references: [id], onDelete: Cascade)

  subjectId Int     @map("subject_id")
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  dayId Int @map("day_id")
  day   Day @relation(fields: [dayId], references: [id], onDelete: Cascade)

  @@map("lesson")
}

model Subject {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  teachers Teacher[] @relation
  lessons  Lesson[]
  replaces Replace[]

  @@map("subject")
}

model Teacher {
  id       Int       @id @default(autoincrement())
  name     String
  lessons  Lesson[]
  replaces Replace[]
  subjects Subject[] @relation

  @@index([name])
  @@map("teacher")
}
